Ok, d·ª±a tr√™n m√¥ t·∫£ chi ti·∫øt c·ªßa b·∫°n, m√¨nh s·∫Ω t√≥m t·∫Øt flow v√† m·ªëi li√™n h·ªá gi·ªØa c√°c l·ªõp cho Use Case View Match History in Clubs, ƒë·ªìng th·ªùi li√™n k·∫øt tr·ª±c ti·∫øp v·ªõi code entity b·∫°n ƒë√£ c√≥:

1Ô∏è‚É£ Goal

Ng∆∞·ªùi d√πng mu·ªën xem danh s√°ch c√°c tr·∫≠n ƒë·∫•u ƒë√£ di·ªÖn ra c·ªßa m·ªôt CLB c·ª• th·ªÉ, v·ªõi c√°c filter t√πy ch·ªçn:

M√πa gi·∫£i (season)

CLB ƒë·ªëi th·ªß (opponentClubName)

C·∫ßu th·ªß tham gia (playerName)

T√¨m ki·∫øm theo m√¥ t·∫£ (search)

K·∫øt qu·∫£ l√† HTML ƒë√£ render (ClubMatchHistory.html) v·ªõi danh s√°ch tr·∫≠n v√† echo c√°c filter.

2Ô∏è‚É£ Entry Point

HTTP Request:

GET /club/{clubId}/matches/history
?season=2024&opponentClubName=MU&playerName=Ronaldo&search=derby


clubId ‚Üí path variable

C√°c filter kh√°c ‚Üí query params

Controller s·∫Ω nh·∫≠n c√°c gi√° tr·ªã n√†y.

3Ô∏è‚É£ Controller Layer ‚Äî MatchHistoryController

Nh·∫≠n clubId + optional query params

G·ªçi Service ƒë·ªÉ l·∫•y danh s√°ch tr·∫≠n l·ªãch s·ª≠

Th√™m attributes v√†o model:

matches ‚Üí list tr·∫≠n

club ‚Üí th√¥ng tin CLB

Filter echoes (season, opponentClubName, playerName, search)

Tr·∫£ v·ªÅ view "ClubMatchHistory"

@GetMapping("/club/{clubId}/matches/history")
public String getHistory(
@PathVariable UUID clubId,
@RequestParam(required=false) String season,
@RequestParam(required=false) String opponentClubName,
@RequestParam(required=false) String playerName,
@RequestParam(required=false) String search,
Model model) {

    List<Match> matches = service.getHistoryFiltered(clubId, season, opponentClubName, playerName, search);
    model.addAttribute("matches", matches);
    model.addAttribute("club", clubService.getClub(clubId));
    model.addAttribute("season", season);
    model.addAttribute("opponentClubName", opponentClubName);
    model.addAttribute("playerName", playerName);
    model.addAttribute("search", search);

    return "ClubMatchHistory";
}

4Ô∏è‚É£ Service Layer ‚Äî ClubMatchHistoryService

Chu·∫©n h√≥a inputs: trim, convert empty ‚Üí null

Parse season th√†nh Integer

L·∫•y LocalDateTime.now() cho vi·ªác x√°c ƒë·ªãnh tr·∫≠n l·ªãch s·ª≠

G·ªçi Repository v·ªõi clubId v√† c√°c filter

Tr·∫£ v·ªÅ List<Match>

Ch√∫ √Ω:

Base logic: matchStartTime <= now

Optional filters: season, opponent, player, search

Optional pagination ƒë·ªÉ tr√°nh tr·∫£ qu√° nhi·ªÅu tr·∫≠n

5Ô∏è‚É£ Repository Layer ‚Äî MatchRepo

Method: findHistoryByClub(...)

JPQL responsibilities:

m.matchStartTime <= :now ‚Üí ch·ªâ tr·∫≠n ƒë√£ di·ªÖn ra

Join v·ªõi MatchClubStat ‚Üí x√°c ƒë·ªãnh CLB tham gia

Optional season filter ‚Üí function('year', m.matchStartTime) = :season

Optional opponent filter ‚Üí t·ªìn t·∫°i MatchClubStat kh√°c v·ªõi CLB hi·ªán t·∫°i

Optional player filter ‚Üí join MatchPlayerStat ‚Üí Player

Optional text search ‚Üí m√¥ t·∫£ ch·ª©a t·ª´ kh√≥a

DISTINCT ‚Üí tr√°nh duplicate

Order by matchStartTime DESC

L∆∞u √Ω: s·ª≠ d·ª•ng joins lazy nh∆∞ng c·∫ßn fetch n·∫øu c√≥ N+1.

6Ô∏è‚É£ Domain Model (Entities)

Match ‚Üí List<MatchClubStat> + List<MatchPlayerStat>

MatchClubStat ‚Üí li√™n k·∫øt Match ‚Üî Club

MatchPlayerStat ‚Üí li√™n k·∫øt Match ‚Üî Player

Club ‚Üí clubId, clubName

Player ‚Üí playerId, playerFullName, Club

Nh·ªù entities n√†y, repository c√≥ th·ªÉ filter nhi·ªÅu ƒëi·ªÅu ki·ªán m√† kh√¥ng c·∫ßn nested loops trong Java.

7Ô∏è‚É£ View Layer ‚Äî ClubMatchHistory.html

Nh·∫≠n matches, club, filter echoes

Hi·ªÉn th·ªã:

Match description

Match start time

Opponent club(s)

Key players

Filter form GET ƒë·ªÉ refine history

<form method="get" th:action="@{/club/{clubId}/matches/history(clubId=${club.clubId})}">
    <input name="season" th:value="${season}" />
    <input name="opponentClubName" th:value="${opponentClubName}" />
    <input name="playerName" th:value="${playerName}" />
    <input name="search" th:value="${search}" />
    <button>Filter</button>
</form>

<ul th:each="m : ${matches}">
    <li>
        <span th:text="${m.matchDescription}"></span> -
        <span th:text="${m.matchStartTime}"></span>
    </li>
</ul>


Filter echo gi·ªØ input ng∆∞·ªùi d√πng khi refresh

Loop qua matches ƒë·ªÉ render l·ªãch s·ª≠ tr·∫≠n ƒë·∫•u

8Ô∏è‚É£ Data Flow Sequence

Browser g·ª≠i GET v·ªõi clubId + query params

Controller nh·∫≠n params ‚Üí g·ªçi Service

Service sanitize inputs ‚Üí g·ªçi Repository

Repository th·ª±c thi JPQL ‚Üí tr·∫£ list Match

Controller addAttribute ‚Üí Thymeleaf render ClubMatchHistory.html

9Ô∏è‚É£ Coupling & Responsibilities
Layer	Responsibility
Controller	Thu th·∫≠p param, g·ªçi service, add model attribute
Service	Input normalization, orchestration, business logic
Repository	Query composition & execution (DB filtering)
Entities	Mapping relational structure
View	Presentation only (Thymeleaf)
üîë Key Considerations

matchStartTime index ‚Üí tƒÉng t·ªëc query

DISTINCT ƒë·ªÉ tr√°nh tr√πng khi join nhi·ªÅu MatchPlayerStat/MatchClubStat

Lazy loading ‚Üí consider fetch join n·∫øu xu·∫•t hi·ªán N+1

Optional pagination ‚Üí tr√°nh large result sets

Ch·ªâ view render, kh√¥ng ch·ª©a business logic

‚úÖ K·∫øt lu·∫≠n:
Use Case n√†y g·∫ßn nh∆∞ t∆∞∆°ng t·ª± View Upcoming Matches, nh∆∞ng logic filter h∆∞·ªõng v·ªÅ tr·∫≠n ƒë√£ di·ªÖn ra (matchStartTime <= now) v√† b·ªï sung filter CLB ƒë·ªëi th·ªß.
C√°c entity hi·ªán t·∫°i (Match, MatchClubStat, MatchPlayerStat, Player, Club) ƒë·ªß ƒë·ªÉ implement UC n√†y theo chu·∫©n MVC.